var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,i=(e,t)=>{for(var s in t||(t={}))a.call(t,s)&&l(e,s,t[s]);if(n)for(var s of n(t))r.call(t,s)&&l(e,s,t[s]);return e},o=(e,n)=>t(e,s(n)),c=(e,t,s)=>new Promise(((n,a)=>{var r=e=>{try{i(s.next(e))}catch(t){a(t)}},l=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?n(e.value):Promise.resolve(e.value).then(r,l);i((s=s.apply(e,t)).next())}));import{u as d,b as u,a as h,j as m}from"./query-core-DwWRvnhE.js";import{r as y}from"./react-core-Cs9Cpqek.js";import{n as p,a as x,g as j,A as g,C as T,M as S,S as C,s as f,B as b,o as v,u as k,F as w,d as B,D as I,v as O,w as N,T as A,x as _,I as L,P as R,y as E,f as M,i as D}from"./antd-core-FghuMedK.js";import{f as U,Q as F,i as P,a as K,A as H,b as Y,r as Q,p as q,c as z,B as $,d as W,e as G,g as V,h as X,j as J,u as Z,k as ee,M as te,l as se,P as ne,m as ae,n as re,o as le,q as ie,S as oe,C as ce,s as de}from"./index-Cb_3p0D2.js";import"./antd-charts-g5ZpOS3X.js";import"./utils-BZyDl944.js";const ue=[F.BET_HISTORIES,"RAW"];function he(e){return d({queryKey:[...ue,e],queryFn:()=>(e=>c(void 0,null,(function*(){return yield Y(H.RAW_BET,{params:e})})))(e),enabled:!1})}function me(e){return d({queryKey:[...ue,"QUICK"],queryFn:()=>(e=>c(void 0,null,(function*(){return yield Y(`${H.RAW_BET}/quick`,{params:{sessionToken:e}})})))(e),enabled:!1})}function ye(){const e=h();return u({mutationKey:[...ue,"RESULT"],mutationFn:e=>(e=>c(void 0,null,(function*(){return yield K(`${H.RAW_BET}/${e.betId}/result`,e)})))(e),onSuccess:()=>{e.invalidateQueries({queryKey:[F.BET_HISTORIES]})}})}function pe(){const e=h();return u({mutationKey:[...ue,"RESULT-BATCH"],mutationFn:e=>(e=>c(void 0,null,(function*(){return yield K(`${H.RAW_BET}/result/batch`,e)})))(e),onSuccess:()=>{e.invalidateQueries({queryKey:[F.BET_HISTORIES]})}})}const xe="styles-module__adminTableWrapper__sEb3q";function je({value:e}){const{Text:t}=p;if(null==e)return null;const s=e>0?{color:"green"}:e<0?{color:"red"}:void 0;return m.jsxs(t,{style:s,children:[e>0?"+":"",e.toLocaleString(),"đ"]})}const ge="styles-module__verticalCenterRow__NXBhl";function Te({children:e,arrayLength:t,index:s,margin:n="0.5rem"}){const a=s<t-1;let r;return r=0===s&&t>0?{marginBottom:n}:a?{marginBottom:n,marginTop:n}:{marginTop:n},m.jsxs(m.Fragment,{children:[m.jsx(x,{className:ge,style:r,children:e}),a&&m.jsx(j,{style:{margin:0}})]})}function Se(e){return[{title:"Mã Cược",key:"betId",dataIndex:"betId",width:120},{title:"Người Cược",key:"player",width:150,render:(t,s)=>{const n=e[s.playerId];return n?m.jsxs(x,{style:{alignItems:"center"},children:[m.jsx(g,{size:32,src:n.avatarUrl,style:{marginRight:8,marginLeft:8}}),m.jsx("p",{style:{marginBottom:0},children:n.playerName})]}):null},filters:Object.values(e).map((e=>({key:e.playerId,text:e.playerName,value:e.playerId}))),onFilter:(e,t)=>t.playerId===e},{title:"Trận Đấu",key:"match",render:(e,t)=>m.jsx(m.Fragment,{children:t.events.map(((e,s)=>m.jsx(m.Fragment,{children:m.jsxs(Te,{arrayLength:t.events.length,index:s,children:[m.jsxs(T,{span:e.secondTeam?11:void 0,className:"team-data",children:[e.firstTeamLogoUrl&&m.jsx(g,{size:24,alt:"first-team-logo",src:e.firstTeamLogoUrl,className:"team-logo"}),m.jsx("b",{className:"team-name",children:e.firstTeam})]}),e.secondTeam&&m.jsxs(m.Fragment,{children:[m.jsx(T,{span:1,className:"team-data",children:m.jsx("h1",{className:"team-data-divider",children:":"})}),m.jsxs(T,{span:11,className:"team-data",children:[e.secondTeamLogoUrl&&m.jsx(g,{size:24,alt:"second-team-logo",src:e.secondTeamLogoUrl,className:"team-logo"}),m.jsx("b",{className:"team-name",children:e.secondTeam})]})]})]},`${e.id}-${s}`)})))})},{title:"Lựa Chọn",key:"event",width:200,render:(e,t)=>t.events.map(((e,s)=>m.jsx(Te,{arrayLength:t.events.length,index:s,children:q(e)},e.id)))},{title:"Kết Quả",children:[{title:"Trận Đấu",key:"matchResult",width:80,render:(e,t)=>m.jsx(m.Fragment,{children:z(t)&&t.events.map(((e,s)=>m.jsx(Te,{index:s,arrayLength:t.events.length,children:m.jsx($,{result:e.result})},e.id)))})},{title:"Cược",key:"result",width:150,render:(e,t)=>m.jsx($,{result:t.result}),filters:Object.values(W).map((e=>({key:e.result,text:e.text,value:e.text}))),onFilter:(e,t)=>{const s=Object.values(W).find((e=>e.result===t.result));return(null==s?void 0:s.text)===e}}]},{title:"Tiền Cược",children:[{title:"Tiền Gốc",key:"betAmount",width:100,render:(e,t)=>m.jsx(je,{value:t.betAmount})},{title:"Tỉ Lệ",children:[{title:"Trận Đấu",key:"matchRatio",width:80,render:(e,t)=>m.jsx(m.Fragment,{children:z(t)&&t.events.map(((e,s)=>m.jsx(Te,{index:s,arrayLength:t.events.length,children:e.ratio},e.id)))})},{title:"Cược",key:"ratio",dataIndex:"ratio",width:60}]},{title:"Lợi Nhuận",key:"actualProfit",width:100,render:(e,t)=>m.jsx(je,{value:t.actualProfit})}]},{title:"Loại Cược",key:"betType",width:130,render:(e,t)=>{switch(t.betType){case G.SINGLE:return m.jsx("b",{children:"Cược Đơn"});case G.ACCUMULATOR:return m.jsx("b",{children:"Cược Xiên"});case G.LUCKY:return m.jsx("b",{children:"Cược May Mắn"});case G.SYSTEM:return m.jsx("b",{children:`Cược Hệ Thống (${t.metadata.combination})`});default:return null}}},{title:"Thời Gian",key:"betTime",dataIndex:"betTime",width:160}]}function Ce({data:e,isOpen:t,onUpdateSuccess:s,onClose:n}){const[a,r]=y.useState(V.WIN),[l,c]=y.useState({}),d=X(e)?J.Single:J.Accumulator,{mutate:u}=Z();y.useEffect((()=>{if(e){const t={};e.events.forEach((e=>t[e.id]=e.result)),c(t)}}),[e]);if(!e)return null;const h=Object.values(W).filter((e=>e.result!==V.NOT_FINISHED)).map((e=>({label:e.text,value:e.result})));return m.jsxs(S,{title:"Cập Nhật Kết Quả Cược",destroyOnClose:!0,centered:!0,maskClosable:!1,closable:!1,open:t,onOk:()=>{const t=o(i({},e),{result:a});if(X(e))t.events[0]&&(t.events[0].result=a);else{for(const e of Object.values(l))if(e===V.NOT_FINISHED)return void f.error(te.SELECT_ALL_MATCH_RESULTS,3);for(const e of t.events)e.result=l[e.id]}u(t,{onSuccess:s})},onCancel:n,children:[m.jsx(ee,{data:e,type:d,isAdminView:!0,isHistoryViewMode:!1}),z(e)&&e.events.map(((e,t)=>m.jsxs(x,{style:{alignItems:"center",margin:"1rem 0.5rem 0 0.5rem"},children:[m.jsx(T,{span:4,children:`Game ${t+1}:`}),m.jsx(T,{span:19,offset:1,children:m.jsx(C,{allowClear:!1,onChange:t=>((e,t)=>{c((s=>o(i({},s),{[e]:t})))})(e.id,t),style:{width:"100%"},options:h})})]},e.id))),!z(e)&&m.jsxs(x,{style:{margin:"1rem 0.5rem 0 0.5rem",alignItems:"center"},children:[m.jsx(T,{span:4,children:"Kết quả:"}),m.jsx(T,{span:19,offset:1,children:m.jsx(C,{allowClear:!1,onChange:e=>(e=>{r(e)})(e),style:{width:"100%"},defaultValue:a,options:h})})]})]})}const fe="styles-module__tableBetHistory__qBCdi";function be({data:e,onUpdateSuccess:t}){const[s,n]=y.useState(!1),[a,r]=y.useState(),{players:l}=se(),o=(e=>null==e?void 0:e.map((e=>e.betType===G.SINGLE?i(i({},e),e.events[0]):e)))(e),c=[{title:"Hành Động",key:"action",width:120,render:(e,t)=>{const s=t.result===V.NOT_FINISHED;return m.jsx(m.Fragment,{children:s&&m.jsx(b,{type:"primary",onClick:()=>(r(t),void n(!0)),children:"Cập Nhật"})})}},...Se(l)],d={size:"middle",className:fe,rowKey:"betId",bordered:!0,columns:c,dataSource:o,pagination:{defaultPageSize:10,showSizeChanger:!0,showTotal:e=>`Tổng: ${e} cược`},scroll:{x:2e3}};return m.jsxs(m.Fragment,{children:[s&&a&&m.jsx(Ce,{data:a,isOpen:s,onUpdateSuccess:()=>{r(void 0),n(!1),t()},onClose:()=>{r(void 0),n(!1)}}),m.jsx(v,i({},d))]})}const ve=e=>Number((null==e?void 0:e.replace(/\$\s?|(,*)/g,""))||0),ke=e=>`${e} đ`.replace(/\B(?=(\d{3})+(?!\d))/g,",");function we({isOpen:e,onUpdateSuccess:t,onClose:s}){const{players:n}=se(),[a,r]=y.useState(),[l,i]=y.useState(0),[o,c]=y.useState(0),[d,h]=y.useState(ne.DEPOSIT),[p,j]=y.useState(ae.MOMO),{mutate:f,isPending:b}=u({mutationFn:P}),v={width:"100%",alignItems:"center",margin:"1rem 0"};return m.jsxs(S,{title:"Thêm Dữ Liệu Thanh Toán Mới",destroyOnClose:!0,centered:!0,maskClosable:!1,closable:!1,open:e,onOk:()=>{a&&f({playerId:a,action:d,paymentMethod:p,amount:o},{onSuccess:()=>{t(),s()}})},onCancel:s,width:"40vw",okButtonProps:{disabled:!a||0===o,loading:b},children:[m.jsxs(x,{style:v,children:[m.jsx(T,{span:7,children:"Người Cược:"}),m.jsx(T,{span:16,children:m.jsx(C,{allowClear:!1,value:a,onChange:e=>{r(e);const t=n[e];t&&(i(t.totalProfit),c(Math.abs(t.totalProfit)),t.totalProfit<0?h(ne.DEPOSIT):h(ne.CASHOUT))},style:{width:"100%"},children:Object.values(n).map((e=>m.jsx(C.Option,{value:e.playerId,children:m.jsxs(x,{children:[m.jsx(g,{src:e.avatarUrl,style:{marginRight:8}}),m.jsx("span",{children:e.playerName})]})},e.playerId)))})})]}),m.jsxs(x,{style:v,children:[m.jsx(T,{span:7,children:"Lợi Nhuận:"}),m.jsx(T,{span:16,children:m.jsx(k,{style:{width:"100%",backgroundColor:"#f7f7f7",color:l>0?"green":l<0?"red":"black"},disabled:!0,value:l,formatter:ke,parser:ve})})]}),m.jsxs(x,{style:v,children:[m.jsx(T,{span:7,children:"Hành Động:"}),m.jsx(T,{span:16,children:m.jsxs(C,{allowClear:!1,value:d,onChange:e=>h(e),style:{width:"100%"},children:[m.jsx(C.Option,{value:"DEPOSIT",children:"Thanh Toán Nợ / Nạp Tiền"}),m.jsx(C.Option,{value:"CASHOUT",children:"Rút Tiền Lời"})]})})]}),m.jsxs(x,{style:v,children:[m.jsx(T,{span:7,children:"Kênh Thanh Toán:"}),m.jsx(T,{span:16,children:m.jsxs(C,{allowClear:!1,value:p,onChange:e=>j(e),style:{width:"100%"},children:[m.jsx(C.Option,{value:"MOMO",children:"Momo"}),m.jsx(C.Option,{value:"BANK",children:"Ngân Hàng"})]})})]}),m.jsxs(x,{style:v,children:[m.jsx(T,{span:7,children:"Số Tiền:"}),m.jsx(T,{span:16,children:m.jsx(k,{style:{width:"100%"},value:o,onChange:e=>c(Math.abs(e||0)),min:0,parser:ve})})]})]})}const{RangePicker:Be}=I;function Ie({onSuccess:e}){const[t]=w.useForm(),{mutate:s,isPending:n}=u({mutationFn:Q});return m.jsxs(w,{form:t,onFinish:t=>{s(t,{onSuccess:e})},layout:"inline",initialValues:{dateRange:[B(),B()]},children:[m.jsx(w.Item,{name:"dateRange",rules:[{required:!0,message:"Vui lòng chọn khoảng thời gian"}],children:m.jsx(Be,{format:"DD/MM/YYYY",disabledDate:e=>e&&e>B().endOf("day")})}),m.jsx(w.Item,{children:m.jsx(O,{children:m.jsx(b,{ghost:!0,type:"primary",htmlType:"submit",loading:n,children:"Chạy Thống Kê"})})})]})}const Oe="styles-module__actionBar__AP5MJ",Ne="styles-module__verticalCenterRow__0IBKm";function Ae({action:e}){switch(e){case ne.BET_WIN:return m.jsx(A,{color:"success",children:"Thắng Cược"});case ne.BET_LOST:return m.jsx(A,{color:"error",children:"Thua Cược"});case ne.CASHOUT:return m.jsx(A,{color:"processing",children:"Rút Tiền"});default:return m.jsx(A,{color:"warning",children:"Nạp Tiền"})}}function _e({data:e,onStatisticSuccess:t,refetch:s}){const{players:n}=se(),[a,r]=y.useState(!1),l=()=>r((e=>!e)),i=[{title:"Người Chơi",key:"player",render:(e,t)=>{const s=n[t.playerId];return s?m.jsxs(x,{className:Ne,children:[m.jsx(g,{size:32,src:s.avatarUrl,style:{marginRight:8,marginLeft:8}}),m.jsx("p",{style:{marginBottom:0},children:s.playerName})]}):null},filters:Object.values(n).map((e=>({key:e.playerId,text:e.playerName,value:e.playerName}))),onFilter:(e,t)=>{var s;const a=n[t.playerId];return(null==(s=null==a?void 0:a.playerName)?void 0:s.includes(e))||!1}},{title:"Thời Gian",key:"paymentTime",dataIndex:"paymentTime"},{title:"Hành Động",key:"action",render:(e,t)=>m.jsx(Ae,{action:t.action})},{title:"Hình Thức Thanh Toán",key:"paymentMethod",dataIndex:"paymentMethod"},{title:"Tài Sản",key:"asset",children:[{title:"Số Tiền Thanh Toán",key:"amount",render:(e,t)=>m.jsx(je,{value:t.amount})},{title:"Số Dư Đầu",key:"assetBefore",render:(e,t)=>m.jsx(je,{value:t.assetBefore})},{title:"Số Dư Cuối",key:"assetAfter",render:(e,t)=>m.jsx(je,{value:t.assetAfter})}]},{title:"Mã Cược",key:"betId",dataIndex:"betId"}];return m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:Oe,children:[m.jsx(Ie,{onSuccess:t}),m.jsx(b,{type:"primary",icon:m.jsx(N,{}),onClick:l,children:"Thêm Thanh Toán"})]}),m.jsx(v,{rowKey:"id",columns:i,dataSource:e,bordered:!0,size:"middle",scroll:{x:1200},pagination:{defaultPageSize:10,showSizeChanger:!0,showTotal:e=>`Tổng: ${e} giao dịch`}}),a&&m.jsx(we,{isOpen:a,onClose:l,onUpdateSuccess:()=>{f.success(te.ADD_PAYMENT_SUCCESS),s()}})]})}const Le="styles-module__tableBetHistory__OJcnk",Re=({data:e,isOpen:t,onUpdateSuccess:s,onClose:n})=>{const{players:a}=se(),[r,l]=y.useState(),{mutate:c,isPending:d}=re(),{mutate:u,isPending:h}=le(),p=Array.isArray(e),j=p?h:d,f=p?e:[e],b=()=>{s(),n()},k=(e=>{const t=Se(e);return t.shift(),t})(a),w=!!p&&{showTotal:e=>`Tổng: ${e} cược`};return m.jsxs(S,{title:"Thêm Cược Mới",destroyOnClose:!0,centered:!0,maskClosable:!1,closable:!1,open:t,onOk:()=>{if(r)if(p){const t=e.map((e=>o(i({},e),{playerId:r})));u(t,{onSuccess:b})}else{const t=o(i({},e),{playerId:r});c(t,{onSuccess:b})}},onCancel:n,width:"80vw",confirmLoading:j,children:[m.jsx(v,{size:"small",className:Le,rowKey:"betId",bordered:!0,columns:k,dataSource:f,pagination:w}),m.jsxs(x,{style:{alignItems:"center",margin:"1rem 0.5rem 0 0.5rem"},children:[m.jsx(T,{span:2,children:"Người Cược:"}),m.jsx(T,{span:4,children:m.jsx(C,{allowClear:!1,value:r,onChange:e=>{l(e)},style:{width:"100%"},children:Object.values(a).map((e=>m.jsx(C.Option,{value:e.playerId,children:m.jsxs(x,{children:[m.jsx(g,{src:e.avatarUrl,style:{marginRight:8}}),m.jsx("span",{children:e.playerName})]})},e.playerId)))})})]})]})};function Ee({data:e,onClickAddBatch:t}){return m.jsx(b,{type:"primary",icon:m.jsx(N,{}),onClick:()=>t(e),style:{marginRight:8},children:"Thêm Tất Cả"})}function Me({data:e,onSuccess:t}){const{mutate:s,isPending:n}=pe(),a=y.useMemo((()=>e.filter((e=>e.rawStatus===ie.ResultReadyToBeUpdated))),[e]);return m.jsx(b,{type:"primary",icon:m.jsx(_,{}),onClick:()=>{s(a,{onSuccess:t})},loading:n,style:{marginRight:8},disabled:0===a.length,children:"Cập Nhật Nhanh"})}const{RangePicker:De}=I;function Ue({form:e,onFinish:t,onQuickFetch:s,loading:n=!1}){return m.jsxs(w,{form:e,onFinish:t,layout:"inline",children:[m.jsx(w.Item,{name:"sessionToken",label:"Token",style:{minWidth:300},children:m.jsx(L,{})}),m.jsx(w.Item,{name:"dateRange",label:"Thời Gian",rules:[{required:!0,message:"Vui lòng chọn khoảng thời gian"}],children:m.jsx(De,{format:"DD/MM/YYYY",disabledDate:e=>e&&e>B().endOf("day"),style:{width:"100%"}})}),m.jsx(w.Item,{children:!n&&m.jsxs(O,{children:[m.jsx(b,{type:"primary",htmlType:"submit",loading:n,children:"Lấy Dữ Liệu"}),m.jsx(b,{ghost:!0,type:"primary",onClick:s,loading:n,children:"Lấy Nhanh"})]})})]})}function Fe({form:e,loading:t,onFetchRawBetList:s,onQuickFetch:n,tableData:a,currentBatchAddBet:r,onClickAddBatch:l,onProcessSuccess:i}){return m.jsxs(x,{justify:"space-between",style:{marginBottom:"1rem"},children:[m.jsx(T,{span:16,children:m.jsx(Ue,{form:e,onFinish:s,onQuickFetch:n,loading:t})}),m.jsxs(T,{span:8,style:{display:"flex",justifyContent:"flex-end"},children:[r.length>0&&m.jsx(Ee,{data:a,onClickAddBatch:l}),m.jsx(Me,{data:a,onSuccess:i})]})]})}const Pe={sessionToken:"",startDate:"",endDate:"",mode:"NORMAL",timestamp:void 0};const Ke="styles-module__rawBetTable__GyWQg",He=({status:e})=>{const t=y.useMemo((()=>({[ie.New]:{color:"warning",text:"Chưa Xử Lý"},[ie.Inserted]:{color:"cyan",text:m.jsxs("p",{style:{marginBottom:0},children:["Đã Lưu Dữ Liệu",m.jsx("br",{}),"Chờ Kết Quả"]})},[ie.ResultReadyToBeUpdated]:{color:"blue",text:m.jsxs("p",{style:{marginBottom:0},children:["Đã Có Kết Quả",m.jsx("br",{}),"Chờ Cập Nhật"]})},[ie.Settled]:{color:"success",text:"Đã Hoàn Tất"}})),[])[e]||{color:void 0,text:e};return m.jsx(A,{color:t.color,children:t.text})},Ye=({record:e,onClickAdd:t,onConfirmUpdate:s})=>e.rawStatus===ie.New?m.jsx(b,{type:"primary",onClick:()=>t(e),children:"Thêm Mới"}):e.rawStatus===ie.ResultReadyToBeUpdated?m.jsx(R,{title:"Xác Nhận ?",icon:m.jsx(E,{style:{color:"red"}}),onConfirm:()=>s(e),children:m.jsx(b,{type:"primary",children:"Cập Nhật"})}):null,Qe=({data:e,onClickAdd:t,onUpdateSuccess:s,onSelectBatchBets:n})=>{const{players:a}=se(),{mutate:r}=ye(),l=e=>{r(e,{onSuccess:()=>{s()}})},o=y.useMemo((()=>null==e?void 0:e.some((e=>{var t;return null==(t=e.events)?void 0:t.some((e=>e.score))}))),[e]),c=y.useMemo((()=>({onChange:(e,t)=>{n(t)},getCheckboxProps:e=>({disabled:e.rawStatus!==ie.New,rawStatus:e.rawStatus})})),[n]),d=y.useMemo((()=>{const e=Se(a),s=[];return o&&s.push({title:"Tỉ Số",key:"score",width:80,render:(e,t)=>t.events.map(((e,s)=>m.jsx(Te,{arrayLength:t.events.length,index:s,children:e.score},e.id)))}),s.push({title:"Trạng Thái",key:"rawStatus",width:150,render:(e,t)=>m.jsx(He,{status:t.rawStatus})},{title:"Hành Động",key:"action",width:120,fixed:"right",render:(e,s)=>m.jsx(Ye,{record:s,onClickAdd:t,onConfirmUpdate:l})}),[...e.slice(0,4),...s,...e.slice(4)]}),[a,o,t,s]);return m.jsx(v,{className:Ke,size:"middle",rowKey:"betId",bordered:!0,columns:d,dataSource:e,rowSelection:i({type:"checkbox"},c),pagination:{defaultPageSize:10,showSizeChanger:!0,showTotal:e=>`Tổng: ${e} cược`},scroll:{x:2e3}})};function qe({onSuccessAction:e}){const[t]=w.useForm(),{modalAddSingleOpen:s,modalAddBatchOpen:n,currentAddBet:a,currentBatchAddBet:r,rawBetList:l,isLoading:c,handleProcessRawBetSuccess:d,handleFetchRawBetList:u,handleQuickFetchRawBetList:h,handleClickAddSingleBet:p,handleClickAddBatchBet:x,handleCloseSingleModal:j,handleCloseBatchModal:g}=function(e,t){const[s,n]=y.useState(!1),[a,r]=y.useState(!1),[l,c]=y.useState(),[d,u]=y.useState([]),[h,m]=y.useState(Pe),{data:p,isLoading:x,refetch:j}=he("NORMAL"===h.mode?{sessionToken:h.sessionToken,startDate:h.startDate,endDate:h.endDate}:{sessionToken:"",startDate:"",endDate:""}),{data:g,isLoading:T,refetch:S}=me("QUICK"===h.mode?h.sessionToken:void 0);y.useEffect((()=>{const t=localStorage.getItem(oe.RAW_BET_QUERY_TOKEN);e&&t&&e.setFieldsValue({sessionToken:t})}),[e]),y.useEffect((()=>{"QUICK"===h.mode?S():"NORMAL"===h.mode&&h.startDate&&h.endDate&&j()}),[h,S,j]);const C=y.useCallback((()=>{u([]),c(void 0),r(!1),n(!1),m((e=>o(i({},e),{timestamp:Date.now()}))),t()}),[t]),f=y.useCallback((e=>{const{sessionToken:t,dateRange:s}=e,n={sessionToken:t,startDate:s[0].format("YYYY-MM-DD"),endDate:s[1].format("YYYY-MM-DD"),mode:"NORMAL",timestamp:Date.now()};m(n),t&&localStorage.setItem(oe.RAW_BET_QUERY_TOKEN,t)}),[]),b=y.useCallback((()=>{const t=e.getFieldValue("sessionToken"),s={sessionToken:t,mode:"QUICK",timestamp:Date.now()};m(s),t&&localStorage.setItem(oe.RAW_BET_QUERY_TOKEN,t)}),[e]),v=y.useCallback((e=>{c(e),n(!0)}),[]),k=y.useCallback((e=>{u(e),r(!0)}),[]),w=y.useCallback((()=>{c(void 0),n(!1)}),[]),B=y.useCallback((()=>{u([]),r(!1)}),[]);return{modalAddSingleOpen:s,modalAddBatchOpen:a,currentAddBet:l,currentBatchAddBet:d,queryParams:h,rawBetList:("NORMAL"===h.mode?p:g)||[],isLoading:x||T,handleProcessRawBetSuccess:C,handleFetchRawBetList:f,handleQuickFetchRawBetList:b,handleClickAddSingleBet:v,handleClickAddBatchBet:k,handleCloseSingleModal:w,handleCloseBatchModal:B}}(t,e);return m.jsxs(m.Fragment,{children:[m.jsx(Fe,{form:t,loading:c,onFetchRawBetList:u,onQuickFetch:h,tableData:l,currentBatchAddBet:r,onClickAddBatch:x,onProcessSuccess:d}),c?m.jsx(ce,{}):m.jsx(Qe,{data:l,onClickAdd:p,onSelectBatchBets:x,onUpdateSuccess:d}),s&&a&&m.jsx(Re,{data:a,isOpen:s,onClose:j,onUpdateSuccess:d}),n&&r.length>0&&m.jsx(Re,{data:r,isOpen:n,onClose:g,onUpdateSuccess:d})]})}function ze(){const{data:e,refetch:t}=de(),{data:s,refetch:n}=d({queryKey:[F.ASSET_HISTORIES,"all"],queryFn:U}),{players:a,refetch:r}=se(),l=()=>{f.success(te.UPDATE_BET_SUCCESS),t(),n(),r()},i=[{label:"Danh Sách Cược",key:"1",children:m.jsx(be,{data:e||[],onUpdateSuccess:l})},{label:"Dữ Liệu Gốc",key:"2",children:m.jsx(qe,{onSuccessAction:l})},{label:"Lịch Sử Thanh Toán",key:"3",children:m.jsx(_e,{onStatisticSuccess:()=>{f.success(te.RUN_STATISTIC_SUCCESS),n()},data:s||[],refetch:n})}];return e&&a?m.jsx("div",{className:xe,children:m.jsx(M,{children:m.jsx(D,{type:"card",items:i})})}):m.jsx(ce,{})}export{ze as default};
